<%= form_for @course, html: {class: 'form-horizontal', role: 'form',onsubmit:'return checkvalidate()'} do |f| %>
    <%= render 'shared/error_messages', :object => @course %>

    <div class="form-group">
      <%= f.label "课程名", class: 'col-sm-2 control-label' %>
      <div class="col-sm-9">
        <div class="input-group">
          <div class="input-group-addon"><span class="glyphicon glyphicon-arrow-right"></span></div>
          <%= f.text_field :name, class: 'form-control', placeholder: "输入课程名" %>
        </div>
      </div>
    </div>

    <div class="form-group">
      <%= f.label "课程属性", class: 'col-sm-2 control-label' %>
      <div class="col-sm-9">
        <div class="input-group">
          <div class="input-group-addon"><span class="glyphicon glyphicon-arrow-right"></span></div>
          <%= f.select(:course_type, ['公共必修课','公共选修课','专业核心课','一级学科核心课','专业普及课','专业研讨课'], {}, {:class => 'form-control'}) %>
        </div>
      </div>
    </div>

    <div class="form-group">
      <%= f.label "课时", class: 'col-sm-2 control-label' %>
      <div class="col-sm-4">
        <div class="input-group">
          <div class="input-group-addon"><span class="glyphicon glyphicon-arrow-right"></span></div>
          <input type="text" class="form-control" placeholder="输入课时" id="class_period_obj"/>  
        </div>
      </div>
      <%= f.label "学分", class: 'col-sm-2 control-label' %>
      <div class="col-sm-3">
        <div class="input-group">
          <div class="input-group-addon"><span class="glyphicon glyphicon-arrow-right"></span></div>
          <select class="form-control" id="class_credit_obj">
              <option value ="">请选择</option>
              <option value ="0.5">0.5</option>
              <option value ="1.0">1.0</option>
              <option value ="1.5">1.5</option>
              <option value ="2.0">2.0</option>
              <option value ="2.5">2.5</option>
              <option value ="3.0">3.0</option>
              <option value ="3.5">3.5</option>
              <option value ="4.0">4.0</option>
              <option value ="4.5">4.5</option>
              <option value ="5.0">5.0</option>
            </select>
        </div>
      </div>
    </div>

    <div class="form-group">
      <%= f.label "上课周数", class: 'col-sm-2 control-label' %>
      <div class="col-sm-9">
        <div class="input-group">
          <div class="input-group-addon"><span class="glyphicon glyphicon-arrow-right"></span></div>
          <%= f.text_field :course_week, class: 'form-control', placeholder: "输入上课周数" %>
        </div>
      </div>
    </div>

    <div id="classTime">
    <div class="form-group" name="sub_classTime">
      <%= f.label "上课时间段", class: 'col-sm-2 control-label' %>
      <div class="col-sm-3">
        <div class="input-group">
          <div class="input-group-addon"><span class="glyphicon glyphicon-arrow-right"></span></div>
            <select class="form-control" name="course_day_obj" >
              <option value ="">请选择</option>
              <option value ="周一">周一</option>
              <option value ="周二">周二</option>
              <option value ="周三">周三</option>
              <option value ="周四">周四</option>
              <option value ="周五">周五</option>
              <option value ="周六">周六</option>
              <option value ="周日">周日</option>
            </select>    
        </div>
      </div>
      <%= f.label "from", class: 'col-sm-1 control-label' %>
      <div class="col-sm-2">
        <div class="input-group">     
            <select class="form-control" name="course_begin_obj">
              <option value ="">节数</option>
              <option value ="1">1</option>
              <option value ="2">2</option>
              <option value ="3">3</option>
              <option value ="4">4</option>
              <option value ="5">5</option>
              <option value ="6">6</option>
              <option value ="7">7</option>
              <option value ="8">8</option>
              <option value ="9">9</option>
              <option value ="10">10</option>
              <option value ="11">11</option>
            </select>           
        </div>
      </div>
      <%= f.label "to", class: 'col-sm-1 control-label' %>
      <div class="col-sm-2">
        <div class="input-group">        
             <select class="form-control" name="course_end_obj">
              <option value ="">节数</option>
              <option value ="2">2</option>
              <option value ="3">3</option>
              <option value ="4">4</option>
              <option value ="5">5</option>
              <option value ="6">6</option>
              <option value ="7">7</option>
              <option value ="8">8</option>
              <option value ="9">9</option>
              <option value ="10">10</option>
              <option value ="11">11</option>
            </select>
        </div>
      </div>
      <div class="btn" onclick="removeClassTime(this)"><span class="glyphicon glyphicon-remove"></span></div>
    </div> 
    </div>

    <div id="otherClassTime"></div>

    <div class="form-group" style="margin-left: 150px">
      <div class="btn btn-default" onclick="addClassTime()"><span class="glyphicon glyphicon-plus">添加上课时间段</span></div>
    </div>
    
    <div class="form-group">
      <%= f.label "授课方式", class: 'col-sm-2 control-label' %>
      <div class="col-sm-9">
        <div class="input-group">
          <div class="input-group-addon"><span class="glyphicon glyphicon-arrow-right"></span></div>
          <%= f.text_field :teaching_type, class: 'form-control', placeholder: "输入授课方式" %>
        </div>
      </div>
    </div>

    <div class="form-group">
      <%= f.label "考试方式", class: 'col-sm-2 control-label' %>
      <div class="col-sm-9">
        <div class="input-group">
          <div class="input-group-addon"><span class="glyphicon glyphicon-arrow-right"></span></div>
          <%= f.text_field :exam_type, class: 'form-control', placeholder: "输入考试方式" %>
        </div>
      </div>
    </div>

    <%if admin_logged_in? %>
        <div class="form-group">
      <%= f.label "编号", class: 'col-sm-2 control-label' %>
      <div class="col-sm-9">
        <div class="input-group">
          <div class="input-group-addon"><span class="glyphicon glyphicon-arrow-right"></span></div>
          <%= f.text_field :course_code, class: 'form-control', placeholder: "待输入" %>
        </div>
      </div>
    </div>
    <div class="form-group">
      <%= f.label "教室", class: 'col-sm-2 control-label' %>
      <div class="col-sm-9">
        <div class="input-group">
          <div class="input-group-addon"><span class="glyphicon glyphicon-arrow-right"></span></div>
          <%= f.text_field :class_room, class: 'form-control', placeholder: "待分配"  %>
        </div>
      </div>
    </div>
    <div class="form-group">
      <%= f.label "限选人数", class: 'col-sm-2 control-label' %>
      <div class="col-sm-9">
        <div class="input-group">
          <div class="input-group-addon"><span class="glyphicon glyphicon-arrow-right"></span></div>
          <%= f.text_field :limit_num, class: 'form-control', placeholder: "待输入" %>
        </div>
      </div>
    </div>
    <%= f.text_field :credit ,id:"credit_obj",style:"display:none"%>
    <%= f.text_field :course_time ,id:"course_time_obj",style:"display:none"%>
    <%else%>
    <%= f.text_field :credit ,id:"credit_obj",style:"display:none"%>
    <%= f.text_field :course_time ,id:"course_time_obj",style:"display:none"%>
    <%= f.text_field :class_room ,:value =>'待分配',style:"display:none"%>
    <%= f.text_field :limit_num,:value =>'100',style:"display:none" %>
    <%end%>


    <script type="text/javascript">
      /////////////上课时间
      var time_Obj=document.getElementById('course_time_obj');
      var day_Obj=document.getElementsByName('course_day_obj');
      var begin_Obj=document.getElementsByName('course_begin_obj');
      var end_Obj=document.getElementsByName('course_end_obj');

      var timelist=time_Obj.value.split(',');
      var formhtml=$('#classTime').html();
        
      for (var i = 0; i < timelist.length; i++) {
        var course_time=timelist[i];

        if (course_time.length!=0) {
          //星期几
          var course_day=course_time.substring(0,2);
          var day_num;
          if (course_day=="周一") {day_num=1;}
          else if (course_day=="周二") {day_num=2;}
          else if (course_day=="周三") {day_num=3;}
          else if (course_day=="周四") {day_num=4;}
          else if (course_day=="周五") {day_num=5;}
          else if (course_day=="周六") {day_num=6;}
          else if (course_day=="周日") {day_num=7;}
      //获取分割线-的位置
      var split_index=course_time.indexOf("-");
      //开始的上课节数  
      var begin_class=course_time.substring(3,split_index);
      //结束的上课节数 
      var end_class=course_time.substring(split_index+1,course_time.length-1);
      if (i<timelist.length-1) {$('#otherClassTime').append(formhtml);}
      ///设置上课时间下拉框
      day_Obj[i].options[day_num].selected=true; 
      begin_Obj[i].options[begin_class].selected=true;
      end_Obj[i].options[end_class-1].selected=true;      
      } ;

      }   

      //////////////课时学分
      var period_Obj=document.getElementById('class_period_obj');
      var credit_Obj=document.getElementById('class_credit_obj');
      var credit_period_Obj=document.getElementById('credit_obj');

      var credit_period=credit_period_Obj.value;
      if (credit_period.length!=0) {
      
        //获取分割线-的位置
        var split_index2=credit_period.indexOf('/');
        //开始的上课节数  
        var period=credit_period.substring(0,split_index2);
        //结束的上课节数 
        var credit=credit_period.substring(split_index2+1,credit_period.length);
        var credit2=credit*2;

        credit_Obj.options[credit2].selected=true; 
        period_Obj.value=period;
      }     
    </script>
    <%= f.submit '提交', class: "btn btn-success btn-block",onclick:"setCourseTime()"%>
    <%= link_to '取消', courses_path, :class => "btn btn-default btn-block" %>
<% end %>

<script type="text/javascript">
  function checkvalidate(){
    //时间
    var day_Obj=document.getElementsByName('course_day_obj');
    var begin_Obj=document.getElementsByName('course_begin_obj');
    var end_Obj=document.getElementsByName('course_end_obj');
    var time_Obj=document.getElementById('course_time_obj');
    var time="";
    for (var i = 0; i < day_Obj.length; i++) {
      var day=day_Obj[i].value;
      var begin=begin_Obj[i].value;
      var end=end_Obj[i].value; 
      if (day.length==0||begin.length==0||end.length==0) {
        alert("请填写上课时间");
        return false;
      }else{
        if (i==day_Obj.length-1) {
         time+=day+'('+begin+'-'+end+')';
         if (day==day_Obj[i-1].value) {
            alert("请选择不同日期的上课时间段");
            return false;
         }
        }else{
         time+=day+'('+begin+'-'+end+'),';
        } 
      }      
    }
    time_Obj.value=time;
    

    //学分
    var set_period_Obj=document.getElementById('class_period_obj');
    var set_credit_Obj=document.getElementById('class_credit_obj');
    var set_credit_period_Obj=document.getElementById('credit_obj');

    var set_period=set_period_Obj.value;
    var set_credit=set_credit_Obj.value;
    var all_period_credit;
    if(set_period.length==0||set_credit.length==0){
      all_period_credit="";
    }else{
      all_period_credit=set_period+'/'+set_credit;
    }
    set_credit_period_Obj.value=all_period_credit;

    if (time_Obj.value.length!=0&&set_credit_period_Obj.value.length!=0) {return true;}
    else{alert("请填写完整课程信息");return false;}
  }
 

  function addClassTime(){
    var firstClassTime=$('#classTime').html().length;
    var secondClassTime=$('#otherClassTime').html().length;
    if ((firstClassTime>1000&&secondClassTime>1000)||secondClassTime>4000) {
        alert("一星期只能有两个上课时间段");
    }else{
        var formhtml="";
      if (firstClassTime>1000) {
        formhtml=$('#classTime').html();
      }else{
        formhtml=$('#otherClassTime').html();
      }
      $('#otherClassTime').append(formhtml);
    }
  }

  function removeClassTime(buttonObj){    
     var sub_time_Obj=$("[name='sub_classTime']");
     var len=sub_time_Obj.length-1;
     if (len==0) {
       alert("请至少选择一个时间段");
     }else{
       var parentdom=buttonObj.parentNode;
       parentdom.remove();
     }  
      
  }

</script>

